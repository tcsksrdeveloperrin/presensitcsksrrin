<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - TC Sukasari</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-gray-100">
        <div class="text-center mb-8">
            <div class="w-16 h-16 bg-blue-600 rounded-2xl mx-auto flex items-center justify-center text-white font-bold text-2xl mb-4 shadow-lg">
                TC
            </div>
            <h2 class="text-2xl font-bold text-gray-800">Selamat Datang</h2>
            <p class="text-gray-500 text-sm">Silakan masuk ke Portal Presensi Sukasari</p>
        </div>

        <form id="loginForm" class="space-y-4">
            <div>
                <input type="email" id="email" placeholder="Email Kantor"
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                    required>
            </div>
            <div>
                <input type="password" id="password" placeholder="Password"
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                    required>
            </div>
            <button type="submit" id="btnLogin"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-blue-200 flex justify-center items-center gap-2">
                <span>Masuk</span>
            </button>
        </form>
        
        <div id="errorMessage" class="hidden mt-4 p-3 bg-red-50 text-red-600 text-xs rounded-lg text-center font-medium">
            </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SUPABASE_URL = "https://ubcjzcczplfakodxgajg.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InViY2p6Y2N6cGxmYWtvZHhnYWpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxODMwNDYsImV4cCI6MjA4NTc1OTA0Nn0.knzmrpJOqbZkduGIvZVK4zApoZiSXqCdhMVzcgkMaBE";
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const loginForm = document.getElementById('loginForm');
        const btnLogin = document.getElementById('btnLogin');
        const errorDiv = document.getElementById('errorMessage');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Reset state
            errorDiv.classList.add('hidden');
            btnLogin.disabled = true;
            btnLogin.innerText = "Mengecek...";

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                // 1. Auth Supabase
                const { data: authData, error: authError } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (authError) throw authError;

                // 2. Ambil Role dari Profile
                const { data: profile, error: profileError } = await supabaseClient
                    .from('profiles')
                    .select('role')
                    .eq('id', authData.user.id)
                    .single();

                if (profileError) throw profileError;

                // 3. Redirect Berdasarkan Role
                if (profile.role === 'owner') {
                    window.location.href = 'report.html';
                } else if (profile.role === 'manager') {
                    window.location.href = 'dashboard.html';
                } else {
                    window.location.href = 'index.html'; // Default untuk staff
                }

            } catch (err) {
                errorDiv.innerText = "Gagal masuk: " + err.message;
                errorDiv.classList.remove('hidden');
                btnLogin.disabled = false;
                btnLogin.innerText = "Masuk";
            }
        });
    </script>
</body>
</html>
